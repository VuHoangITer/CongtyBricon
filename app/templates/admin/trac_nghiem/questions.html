{% extends 'layouts/admin.html' %}

{% block title %}Qu·∫£n l√Ω C√¢u H·ªèi - {{ quiz.title }}{% endblock %}

{% block extra_css %}
<style>
.question-card {
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border-radius: 8px;
    margin-bottom: 1rem;
}
.question-header {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px 8px 0 0;
}
.hover-question:hover {
    background: #FFF8E1;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
        <h2 class="mb-0"><i class="bi bi-question-circle me-2"></i> C√¢u H·ªèi cho Quiz: {{ quiz.title }}</h2>
        <div class="d-flex gap-2">
            <!-- üîô Quay l·∫°i -->
            <a href="{{ url_for('admin.quizzes') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Quay l·∫°i
            </a>
        </div>
    </div>

    <!-- Form Th√™m C√¢u H·ªèi Nhanh -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">Th√™m C√¢u H·ªèi M·ªõi</div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('admin.add_question') }}">
                <input type="hidden" name="quiz_id" value="{{ quiz.id }}">
                <div class="mb-3">
                    <label class="form-label">C√¢u H·ªèi</label>
                    <textarea name="question_text" class="form-control" rows="2" required></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Gi·∫£i Th√≠ch Cho C√¢u H·ªèi (T√πy Ch·ªçn)</label>
                    <textarea name="explanation" class="form-control" rows="2"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Lo·∫°i C√¢u H·ªèi</label>
                    <select name="question_type" class="form-select">
                        <option value="multiple_choice" selected>Tr·∫Øc nghi·ªám</option>
                        <option value="true_false">ƒê√∫ng / Sai</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">ƒêi·ªÉm</label>
                    <input type="number" name="points" class="form-control" value="1" min="1">
                </div>
                <div class="mb-3">
                    <label class="form-label">ƒê√°p √Ån (Th√™m √≠t nh·∫•t 2, ch·ªçn ƒë√∫ng b·∫±ng radio)</label>
                    <div id="answers-container">
                        <div class="input-group mb-2">
                            <input type="radio" name="correct_answer" value="0" checked>
                            <input type="text" name="answers[]" class="form-control" placeholder="ƒê√°p √°n 1" required>
                        </div>
                        <div class="input-group mb-2">
                            <input type="radio" name="correct_answer" value="1">
                            <input type="text" name="answers[]" class="form-control" placeholder="ƒê√°p √°n 2" required>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-info" onclick="addAnswerField()"><i class="bi bi-plus"></i> Th√™m ƒê√°p √Ån</button>
                </div>
                <button type="submit" class="btn btn-primary">Th√™m C√¢u H·ªèi</button>
            </form>
        </div>
    </div>

        <!-- Danh S√°ch C√¢u H·ªèi -->
        <div class="row">
            {% for question in questions %}
            <div class="col-md-4 col-lg-3 mb-4">
                <div class="question-card h-100">
                    <div class="question-header d-flex justify-content-between align-items-center">
                        <strong>C√¢u {{ loop.index }}:</strong>
                        <div>
                            <a href="{{ url_for('admin.edit_question', id=question.id) }}" class="btn btn-sm btn-warning"><i class="bi bi-pencil"></i></a>
                            <a href="{{ url_for('admin.delete_question', id=question.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('X√°c nh·∫≠n x√≥a?')"><i class="bi bi-trash"></i></a>
                        </div>
                    </div>
                    <div class="card-body">
                        <p><strong>C√¢u h·ªèi:</strong> {{ question.question_text }}</p>
                        <p><strong>ƒêi·ªÉm:</strong> {{ question.points }}</p>
                        <ul>
                            {% for answer in question.answers.all() %}
                            <li {% if answer.is_correct %}class="text-success fw-bold"{% endif %}>
                                {{ answer.answer_text }} {% if answer.is_correct %}(ƒê√∫ng){% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
</div>
<script>
function addAnswerField() {
    const container = document.getElementById('answers-container');
    const index = container.children.length;
    const div = document.createElement('div');
    div.className = 'input-group mb-2';
    div.innerHTML = `
        <input type="radio" name="correct_answer" value="${index}">
        <input type="text" name="answers[]" class="form-control" placeholder="ƒê√°p √°n ${index + 1}" required>
    `;
    container.appendChild(div);
}
</script>
{% endblock %}